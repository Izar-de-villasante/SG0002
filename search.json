[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "SG0002",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books."
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "This book is created to present the integration of methylation and expression data for the HIV TAT protein project.\nColaborator name1: Victor Casanova\nColaborator name2: Andrea Rodriguez\nDate: 04 / 07 / 2023"
  },
  {
    "objectID": "integrative_analysis.html#sample-sheet",
    "href": "integrative_analysis.html#sample-sheet",
    "title": "2  Expression data analysis",
    "section": "2.1 Sample sheet",
    "text": "2.1 Sample sheet\nThe correspondence between the methylome and transcriptome names are:\n- vector with FULL protein (without doxy): \"Tat\" (RNAseq [Tat_1, Tat_2, Tat_3]) = \"TAT_NO\" (microarrays [HC_SEN 3,9,14])\n- vector with PARTIAL protein (without doxy):\"Tat72\" (RNAseq [Tat72_1, Tat72_2, Tat72_3]) = \"Exon1_No\" (microarrays [HC_SEN 5,11,16]) \n\n- vector with FULL protein (with doxy): \"TatDOX\" (RNAseq [TatDOX_1, TatDOX_2, TatDOX_3]) = \"TAT_Dox\" (microarrays [HC_SEN 4,10,15])\n- vector with PARTIAL protein (with doxy): \"Tat72DOX\" (RNAseq [Tat72DOX_1, Tat72DOX_2, Tat72DOX_3]) = \"Exon1_Dox\" (microarrays [HC_SEN 6,12])\n\n- vector without protein (empty): \"TetOFF\" (RNAseq [TetOFF_1, TetOFF_2, TetOFF_3]) = \"Control_NO\" (microarrays [HC_SEN 1,7,13])\n- vector without protein (empty) + doxy: \"TetOFFDOX\" (RNAseq [TetOFFDOX_1, TetOFFDOX_2, TetOFF_3]) = \"Control_Dox\" (microarrays [HC_SEN 2,8])\n\ndtable(ss)"
  },
  {
    "objectID": "integrative_analysis.html#expression",
    "href": "integrative_analysis.html#expression",
    "title": "2  Expression data analysis",
    "section": "2.2 Expression:",
    "text": "2.2 Expression:\n\n2.2.1 Counnts:\n\nnamedlist &lt;- function(...) {\n  nl &lt;- list(...)\n  argnames &lt;- sys.call()\n  n&lt;-sapply(argnames[-1], as.character)\n  names(nl)&lt;-n\n\n  \n  return(nl)\n  }\n\nlibrary(readxl)\nlibrary(data.table)\ncounts&lt;-list()\nTat72_off &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/Tat72VSTetOFF.xlsx\", sheet = 1)\n\nNew names:\n• `` -&gt; `...1`\n\ncolnames(Tat72_off) &lt;- c(\"gene\",sapply(colnames(Tat72_off),function(x)unlist(strsplit(x,\"\\\\.\"))[7])[-1])\nsetDT(Tat72_off)\nTat72_off[,ID :=tstrsplit(gene,\"\\\\.\",keep=1)]\n\nTat_Tat72 &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/TatVSTat72.xlsx\", sheet = 1)\n\nNew names:\n• `` -&gt; `...1`\n\ncolnames(Tat_Tat72) &lt;- c(\"gene\",sapply(colnames(Tat_Tat72),function(x)unlist(strsplit(x,\"\\\\.\"))[7])[-1])\nsetDT(Tat_Tat72)\nTat_Tat72[,ID :=tstrsplit(gene,\"\\\\.\",keep=1)]\n\n\nTat_off &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/TatVSTetOFF.xlsx\", sheet = 1)\n\nNew names:\n• `` -&gt; `...1`\n\ncolnames(Tat_off) &lt;- c(\"gene\",sapply(colnames(Tat_off),function(x)unlist(strsplit(basename(x),\"\\\\.\"))[1])[-1])\nsetDT(Tat_off)\nTat_off[,ID :=tstrsplit(gene,\"\\\\.\",keep=1)]\n\ncounts &lt;-namedlist(Tat72_off,Tat_Tat72,Tat_off)\n\n\ndtable(counts[[1]])\n\nWarning in instance$preRenderHook(instance): It seems your data is too big for\nclient-side DataTables. You may consider server-side processing:\nhttps://rstudio.github.io/DT/server.html"
  },
  {
    "objectID": "integrative_analysis.html#degs",
    "href": "integrative_analysis.html#degs",
    "title": "2  Expression data analysis",
    "section": "2.3 DEGs:",
    "text": "2.3 DEGs:\n\nlibrary(readxl)\nlibrary(data.table)\n\nTat72_off &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/Tat72VSTetOFF.xlsx\", sheet = 3)\nTat72_off$Contrast=\"Tat72_off\"\nTat_Tat72 &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/TatVSTat72.xlsx\", sheet = 3)\nTat_Tat72$Contrast=\"Tat_Tat72\"\nTat_off &lt;- readxl::read_xlsx(\"data-raw/Transcriptome_HClinic_Vcasanova_20042023/TatVSTetOFF.xlsx\", sheet = 3)\nTat_off$Contrast=\"Tat_off\"\n\n\ndt_DEGs &lt;- data.table::data.table(rbind(Tat_Tat72,Tat72_off,Tat_off))\n# dt_DEGs &lt;- dt_DEGs[RealFC&lt;0.5 | RealFC &gt;2,]\n\n\ndtable(dt_DEGs)\n\nWarning in instance$preRenderHook(instance): It seems your data is too big for\nclient-side DataTables. You may consider server-side processing:\nhttps://rstudio.github.io/DT/server.html"
  },
  {
    "objectID": "integrative_analysis.html#methylation",
    "href": "integrative_analysis.html#methylation",
    "title": "2  Expression data analysis",
    "section": "2.4 Methylation:",
    "text": "2.4 Methylation:\n“El primer objetivo es ver si la proteína TAT del VIH, induce cambios en el metiloma. La proteína TAT está codificada por 2 exones que realizan funciones diferentes y queremos además aislar el efecto de cada uno, por eso hemos generado unas líneas celulares de jurkat establemente transfectadas con:\n\nUn vector vacío que será nuestro control: muestras 1, 7 y 13 (triplicados)\nUn vector con la proteína TAT completa: muestras 3, 9 y 14 (triplicados)\nUn vector con solo el primer exón de TAT: muestras 5, 11 y 16 (triplicados)\n\nLa comparativa entre estos tres grupos es la primera que nos interesa. a-b, a-c y b-c.”\nPor otro lado, la DOXYCICLINA “apaga” la expresión de TAT y el segundo objetivo entonces es ver si el “apagado” de TAT con la DOXY hace algún cambio en el metiloma. Por eso la comparativa aquí sería cada una de las tres líneas anteriores con y sin DOXY, así que tendremos además las siguientes muestras:\n\nUn vector vacío que será nuestro control + DOXY: muestras 2 y 8 (duplicados)\nUn vector con con la proteína TAT completa + DOXY: muestras 4, 10 y 15 (triplicados)\nUn vector con solo el primer exón de TAT + DOXY: muestras 6 y 12 (duplicados)\n\nLa segunda comparativa que nos interesa, por tanto, es. a-d, b-e y c-f.\nWhile the first objective yielded positive results no difference was found for the second (Doxi) apporach.\n\n2.4.1 PCA plot:\nPCR plots:\n\n\n\nPCA\n\n\n\n\n2.4.2 DMRS:\n\ndmrs&lt;-readRDS(\"data/dmrs.rds\")\nano_cols&lt;-c(\"seqnames\",\"start\",\"end\",\"width\",\"no.cpgs\",\"HMFDR\",\"meandiff\",\"Contrast\")\ndt_list&lt;- lapply(\n  1:NROW(dmrs),function(rn){  # For every position or ProbeID do:     \n    UCSC &lt;- data.table(      # 1. generate a data.table (per row)\n      dmrs[rn,       # 2. split UCSC gene and position    \n               lapply(       # 3. new row for every combination of gene/position\n                 overlapping.genes,        # 4. add Contrast porbeID and bval difference\n                 function(x)unlist(strsplit(x,\",\"))\n                 )\n               ,by=ano_cols]\n      )\n    })\ndt_dmrs &lt;- rbindlist(dt_list)\nDMRs &lt;- dt_dmrs[,Gene:=V1][!is.na(V1),]\nDMRs$V1 &lt;- NULL\n# c1&lt;-DMRs[Contrast== \"Control_No-Exon1_No\",.(.SD,meandiff=-meandiff,Contrast=\"Tat72_off\"),.SDcols=ano_cols[!ano_cols %in% c(\"meandiff\",\"Contrast\")]]\nc1&lt;-DMRs[Contrast== \"Control_No-Exon1_No\",]\nc1$Contrast &lt;- \"Tat72_off\"\nc1$meandiff &lt;- -c1$meandiff\n\nc2&lt;-DMRs[Contrast== \"Control_No-TAT_No\",]\nc2$Contrast &lt;- \"Tat_off\"\nc2$meandiff &lt;- -c2$meandiff\n\nc3&lt;-DMRs[Contrast== \"Exon1_No-TAT_No\",]\nc3$Contrast &lt;- \"Tat_Tat72\"\nc3$meandiff &lt;- -c3$meandiff\nDMRs&lt;-rbind(c1,c2,c3)\nsaveRDS(DMRs,\"data/DMRs.rds\")\n\n\ndtable(DMRs)"
  },
  {
    "objectID": "integrative_analysis.html#dmrs-vs-expression",
    "href": "integrative_analysis.html#dmrs-vs-expression",
    "title": "2  Expression data analysis",
    "section": "2.5 DMRs vs expression",
    "text": "2.5 DMRs vs expression\n\ndt_DEG_DMR &lt;- merge(DMRs,dt_DEGs,by=c(\"Gene\",\"Contrast\"),all = T)\ntab &lt;- dt_DEG_DMR[,.(DEGs=sum(!is.na(ID)),DMRs=sum(!is.na(start)),overlap=sum(!(is.na(start)) &!(is.na(ID)) )),by=c(\"Contrast\")]\nkableExtra::kbl(tab)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nContrast\nDEGs\nDMRs\noverlap\n\n\n\n\nTat_Tat72\n3087\n1092\n224\n\n\nTat_off\n3102\n990\n207\n\n\nTat72_off\n1594\n53\n8\n\n\n\n\n\n\n\n\n2.5.1 Venn diagrams:\n\n\n2.5.2 DEG/DMR overlapping Correlations:\nNow we want to get the mean beta value for each sample in the dmr location: 1. Find all cpg that fall in the dmr 2. get the mean for each sample 3. Match each sample bVal with it’s expression value. (No way to do it, since there is no key sample to sample) 4. Make correlation 5. Plot.\n\nol &lt;- dt_DEG_DMR[!(is.na(start)) &!(is.na(ID)),]\n\n\nlibrary(data.table)\nlibrary(GenomicRanges)\nlibrary(IlluminaHumanMethylationEPICanno.ilm10b2.hg19)\n\nlocs &lt;- IlluminaHumanMethylationEPICanno.ilm10b2.hg19::Locations\nlocs.ranges &lt;- GRanges(locs$chr, IRanges(locs$pos, locs$pos))\nnames(locs.ranges) &lt;- rownames(locs)\nlocs.ranges$gene_element &lt;- IlluminaHumanMethylationEPICanno.ilm10b2.hg19::Other$UCSC_RefGene_Group\nlocs.ranges$gene &lt;- IlluminaHumanMethylationEPICanno.ilm10b2.hg19::Other$UCSC_RefGene_Name\ndt_DEG_DMR_intersect&lt;-lapply(1:NROW(ol),function(nr){\n  cont&lt;-ol[nr,Contrast]\n  xpr &lt;- counts[[cont]][ID==ol[nr,ID]]\n  xpr&lt;-xpr[,.SD,.SDcols=names(xpr)[!(names(xpr)%in%c(\"ID\",\"gene\"))]]\n  expression &lt;- suppressWarnings(melt(xpr,measure.vars=colnames(xpr),variable.name = \"SID\",value.name = \"TPM\" ))\n  SIDs &lt;- as.character(expression$SID)\n  cgs &lt;- names(subsetByOverlaps(locs.ranges,GRanges(ol[nr,])))\n  #### Annotate DMRs with genomic location:\n  \n  ann&lt;-as.data.table(mcols( subsetByOverlaps(locs.ranges,GRanges(ol[nr,]))))\n\n  # Possibility of multiple genes and genomic location per probe\n  genomic&lt;-lapply(\n  1:NROW(ann),function(cg){  # For every position or ProbeID do:\n    UCSC &lt;- data.table(      # 1. generate a data.table (per row)\n      ann[cg,       # 2. split UCSC gene and position\n               lapply(       # 3. new row for every combination of gene/position\n                 .SD,        # 4. add Contrast porbeID and bval difference\n                 function(x)unlist(strsplit(x,\";\"))\n                 )\n               \n               ,.SDcols=c(\"gene_element\",\"gene\")]\n      )\n    })\n  # 5. rbind all together:\n  genomic_loc &lt;- rbindlist(genomic)|&gt; unique() # should get gene annotation from here to be fair\n  ge &lt;- factor(genomic_loc$gene_element,levels = c(\"3'UTR\",\"ExonBnd\", \"1stExon\",\"5'UTR\",\"Body\",\"TSS200\",\"TSS1500\"),ordered=T  )\n  gene_location &lt;- ifelse(startsWith( as.character(max(ge)),\"TSS\" ),\"promoter\",\"intragenic\")\n  gene_element  &lt;- paste(genomic_loc$gene_element,collapse = \";\")\n\n\n  ####\n  b&lt;-betas[probeID %in% cgs ,lapply(.SD,function(x)mean(x,na.rm=T)),.SDcols=SIDs] \n  meth &lt;- suppressWarnings( melt(b,measure.vars=colnames(b),variable.name = \"SID\",value.name = \"DMR.meth\" ))\n  # list(meth,expression)\n  m &lt;- merge(meth,expression,by=\"SID\")\n  m &lt;- m[,lapply(.SD,as.numeric),by=SID]\n  dt&lt;-cbind(ol[nr,],m)\n  cor&lt;-cor.test(dt$DMR.meth,dt$TPM)\n  dt$correlation &lt;- cor$estimate\n  dt$cor.pval &lt;- cor$p.value\n  dt$gene_element &lt;- gene_element\n  dt$gene_location &lt;- gene_location\n  return(dt)\n  })|&gt;rbindlist()\ndt_DEG_DMR_intersect[,grp:=tstrsplit(SID,\"_\",keep = 1)]\n\n\ndt_cor &lt;-dt_DEG_DMR_intersect\nsetorder(dt_cor,cor.pval,Gene)\nsaveRDS(dt_cor,\"data/dt_cor.rds\")\n\n\n2.5.2.1 Table for DMR & DEG:\nIn the following table the values for methylation and expression are integrated:\n\ndtable(dt_cor[,.SD,.SDcols=c(\"Gene\",\"Contrast\",\"SID\",\"DMR.meth\",\"TPM\",\"correlation\",\"cor.pval\")])\n\n\n\n\n\n\n\n\n\n2.5.3 Plots\n\nlibrary(ggplot2)\nlibrary(data.table)\nlibrary(ggpubr)\nlibrary(ggrepel)\nDMR_DEG_plots &lt;- list()\nplots_folder &lt;- \"analysis/Integration_with_expression/DEGvsDMR/pval\"\ndir.create(plots_folder,recursive = T,showWarnings = F)\nsetkeyv(dt_cor,c(\"cor.pval\",\"Gene\",\"width\"))\n\nfor(cont in unique(dt_cor$Contrast)){\n  dt&lt;-head(dt_cor[Contrast==cont,],60)\n  lg &lt;- dt[,.(gene=unique(Gene),width=unique(width)),by=cor.pval] \n  \n  plist &lt;- lapply(1:NROW(lg),function(nr){\n    pdata &lt;- dt_cor[lg[nr,]]\n    plot_name &lt;- paste0(\"/DEG_DMR.pval_\", nr, \".png\")\n    plt_path &lt;- paste(plots_folder, cont, sep = .Platform$file.sep) \n    dir.create(plt_path,recursive = T,showWarnings = F)\n    p&lt;-ggplot(data=pdata, aes(x=as.numeric(TPM),y=as.numeric(DMR.meth),colour=SID)) +\n    geom_point(aes(shape=grp),size=8,alpha=0.6) +\n    xlab(\"Mean DMR methylation\") + ylab(\"Transcripts x Milion\") +\n\n    geom_smooth(method = \"lm\",\n                inherit.aes = F,\n                aes(x=as.numeric(pdata$TPM),y=as.numeric(pdata$DMR.meth)),\n                linetype=\"dashed\",\n                se=F,\n                formula = \"y ~ x\")+\n    \n    annotate(geom = \"text\",\n             x = -Inf, y = Inf,\n             label=paste0(\"correlation: \", round(unique(pdata$correlation),4), \", p-value: \", round(unique(pdata$cor.pval),8)),\n             hjust = 0, vjust = 1\n             )  +\n\n    ggtitle(paste0(\" Correlation between expression and methylation for gene: \",unique(pdata$Gene)))\n    ggsave(path = plt_path, filename = plot_name, plot=p)\n    return(p)\n  })\n  DMR_DEG_plots[[cont]] &lt;- plist\n  }\nsaveRDS(DMR_DEG_plots,\"data/DMR_DEG_plots.rds\")\n\n\n2.5.3.1 Tat_Tat72\n\nDMR_DEG_plots[[\"Tat_Tat72\"]]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.3.2 Tat_off\n\nDMR_DEG_plots[[\"Tat_off\"]]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.3.3 Tat72_off\n\nDMR_DEG_plots[[\"Tat72_off\"]]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.4 Pathway analysis\nThe pathways analysis will be performed analysing 2 sets of genes: 1. Full DMR/DMPs: the full set of significant diferentially methylated & expressed genes. 2. Cor.sig: A subset of the above where the correlation p.value is smaller than 0.05\n\n2.5.4.1 Full\nThis dataset is not filtered by the strength of the correlation between DMRs and DEGs.\n\n2.5.4.1.1 DNA methylation context:\nAlthough the relationship between DNA methylation and gene expression is complex and the mechanisms involved in gene regulation by DNA methylation are diverse. Fortunately, over the years researchers have found some common relationships between gene methylation and gene expression:\nDNA methylation is an epigenetic mark that has been traditionally associated with gene silencing, specially when methylation happens on promoter regions. DNA methylation is related with the repressed chromatin state which blocks the access of transcription factors to promoter regions. Thus, silencing promoter activity in a stable way and reducing transcription Suzuki and Bird (2008).\nIn the other hand, the bodies of active genes in plants and animals are often heavily methylated. Suzuki and Bird (2008)\nTherefore, usually it is expected to find most of the genes to have negative correlations between DNA methylation and gene transcription in promoter regions while some of the genes might present positive correlations specially in intra-genic regions.\nNow, let’s inspect our data, the following table shows a summary of the paired DMGs and DEGs:\n\ntab.full &lt;- dt_cor[,.(negative.cor=sum(correlation&lt;0)/6,positive.cor=sum(correlation&gt;0)/6,Total=sum(correlation!=0)/6),by=c(\"Contrast\")]\nkableExtra::kbl(tab.full)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nContrast\nnegative.cor\npositive.cor\nTotal\n\n\n\n\nTat_off\n84\n123\n207\n\n\nTat_Tat72\n106\n118\n224\n\n\nTat72_off\n3\n5\n8\n\n\n\n\n\n\n\n::: callout-warning {.column-page-inset} Be aware that DMGs are based on DMRs. More than one DMR can be mapped to the same gene. Therefore, there can be more than one pair of DMG/DEG for the same gene as it happens for LTBP1 gene in Tat72_off contrast.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nContrast\nseqnames\nstart\nend\nno.cpgs\nwidth\ngene_element\ngene_location\nGene\n\n\n\n\nTat72_off\nchr13\n67551364\n67551521\n3\n158\nTSS200;Body;Body\npromoter\nPCDH9\n\n\nTat72_off\nchr3\n15311021\n15311269\n4\n249\nBody;5’UTR\nintragenic\nSH3BP5\n\n\nTat72_off\nchr5\n172070871\n172072282\n3\n1412\nBody\nintragenic\nNEURL1B\n\n\nTat72_off\nchr3\n116163694\n116164943\n13\n1250\n5’UTR;1stExon;TSS200;Body;TSS1500\npromoter\nLSAMP\n\n\nTat72_off\nchr4\n157713603\n157714561\n3\n959\nBody\nintragenic\nPDGFC\n\n\nTat72_off\nchrY\n21877683\n21878594\n3\n912\nBody;ExonBnd\nintragenic\nKDM5D\n\n\nTat72_off\nchr2\n33495871\n33495908\n3\n38\nBody\nintragenic\nLTBP1\n\n\nTat72_off\nchr2\n33216742\n33217280\n3\n539\nBody\nintragenic\nLTBP1"
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "3  Summary",
    "section": "",
    "text": "In summary, this book has no content whatsoever."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Suzuki, Miho M., and Adrian Bird. 2008. “DNA Methylation\nLandscapes: Provocative Insights from Epigenomics.” Nature\nReviews Genetics 9 (June): 465–76. https://doi.org/10.1038/nrg2341."
  }
]